{"ast":null,"code":"var _jsxFileName = \"/Users/mirbekmuratov/Desktop/react_chapter_9_updated/src/contexts/authContext.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from 'react';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const authContext = /*#__PURE__*/React.createContext();\nconst API = 'http://34.173.115.25/api/v1';\n\nconst AuthContextProvider = _ref => {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [currentUser, setCurrentUser] = useState(false);\n  const [error, setError] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  async function handleRegister(formData, navigate) {\n    setLoading(true);\n\n    try {\n      const res = await axios.post(`${API}/account/register/`, formData);\n      navigate('/register-success');\n    } catch (err) {\n      setError(Object.values(err.response.data).flat(2));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleLogin(formData, email, navigate) {\n    try {\n      const res = await axios.post(`${API}/account/login/`, formData);\n      localStorage.setItem('tokens', JSON.stringify(res.data));\n      localStorage.setItem('email', email);\n      setCurrentUser(email);\n      navigate('/'); // console.log(res);\n    } catch (err) {\n      console.log(err);\n      setError([err.response.data.detail]);\n    }\n  }\n\n  async function checkAuth() {\n    console.log('Check Auth Worked!');\n    setLoading(true);\n\n    try {\n      const tokens = JSON.parse(localStorage.getItem('tokens')); //config\n\n      const Authorization = `Bearer ${tokens.access}`;\n      const config = {\n        headers: {\n          Authorization\n        }\n      };\n      const res = await axios.post(`${API}/account/token/refresh/`, {\n        refresh: tokens.refresh\n      }, config);\n      localStorage.setItem('tokens', JSON.stringify({\n        access: res.data.access,\n        refresh: tokens.refresh\n      }));\n      const email = localStorage.getItem('email');\n      setCurrentUser(email);\n    } catch (err) {\n      console.log(err);\n      handleLogout();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function handleLogout(navigate) {\n    localStorage.removeItem('tokens');\n    localStorage.removeItem('email');\n    setCurrentUser(false);\n    navigate('/login');\n  }\n\n  return /*#__PURE__*/_jsxDEV(authContext.Provider, {\n    value: {\n      currentUser,\n      error,\n      loading,\n      setError,\n      handleRegister,\n      handleLogin,\n      checkAuth,\n      handleLogout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 83,\n    columnNumber: 5\n  }, this);\n};\n\n_s(AuthContextProvider, \"HKbDGnYJGQHqxeIC1hJEGPmaA20=\");\n\n_c = AuthContextProvider;\nexport default AuthContextProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthContextProvider\");","map":{"version":3,"names":["React","useState","axios","authContext","createContext","API","AuthContextProvider","children","currentUser","setCurrentUser","error","setError","loading","setLoading","handleRegister","formData","navigate","res","post","err","Object","values","response","data","flat","handleLogin","email","localStorage","setItem","JSON","stringify","console","log","detail","checkAuth","tokens","parse","getItem","Authorization","access","config","headers","refresh","handleLogout","removeItem"],"sources":["/Users/mirbekmuratov/Desktop/react_chapter_9_updated/src/contexts/authContext.js"],"sourcesContent":["import React, { useState } from 'react';\nimport axios from 'axios';\n\nexport const authContext = React.createContext();\n\nconst API = 'http://34.173.115.25/api/v1';\n\nconst AuthContextProvider = ({ children }) => {\n  const [currentUser, setCurrentUser] = useState(false);\n  const [error, setError] = useState(false);\n  const [loading, setLoading] = useState(false);\n\n  async function handleRegister(formData, navigate) {\n    setLoading(true);\n    try {\n      const res = await axios.post(`${API}/account/register/`, formData);\n      navigate('/register-success');\n    } catch (err) {\n      setError(Object.values(err.response.data).flat(2));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function handleLogin(formData, email, navigate) {\n    try {\n      const res = await axios.post(`${API}/account/login/`, formData);\n      localStorage.setItem('tokens', JSON.stringify(res.data));\n      localStorage.setItem('email', email);\n      setCurrentUser(email);\n      navigate('/');\n      // console.log(res);\n    } catch (err) {\n      console.log(err);\n      setError([err.response.data.detail]);\n    }\n  }\n\n  async function checkAuth() {\n    console.log('Check Auth Worked!');\n    setLoading(true);\n    try {\n      const tokens = JSON.parse(localStorage.getItem('tokens'));\n      //config\n      const Authorization = `Bearer ${tokens.access}`;\n      const config = {\n        headers: {\n          Authorization,\n        },\n      };\n      const res = await axios.post(\n        `${API}/account/token/refresh/`,\n        {\n          refresh: tokens.refresh,\n        },\n        config\n      );\n      localStorage.setItem(\n        'tokens',\n        JSON.stringify({\n          access: res.data.access,\n          refresh: tokens.refresh,\n        })\n      );\n      const email = localStorage.getItem('email');\n      setCurrentUser(email);\n    } catch (err) {\n      console.log(err);\n      handleLogout();\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  function handleLogout(navigate) {\n    localStorage.removeItem('tokens');\n    localStorage.removeItem('email');\n    setCurrentUser(false);\n    navigate('/login');\n  }\n\n  return (\n    <authContext.Provider\n      value={{\n        currentUser,\n        error,\n        loading,\n        setError,\n        handleRegister,\n        handleLogin,\n        checkAuth,\n        handleLogout,\n      }}\n    >\n      {children}\n    </authContext.Provider>\n  );\n};\nexport default AuthContextProvider;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}